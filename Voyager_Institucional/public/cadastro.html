<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulário de Cadastro</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/estilo-cadastro.css">
</head>

<body>
    <div class="telaEtapa1 tela" id="telaInfo">
        <h1 class="titulo">Um pouco sobre você</h1>
        <div class="container">
            <div class="formulario-Etapa1 form">
                <div class="bloco-form">
                    <span>Seu Nome</span><br>
                    <input type="text" id="txtNome" value="Davi Alexandre">
                </div>
                <div class="bloco-form">
                    <span>Seu Telefone</span><br>
                    <div class="linha-form">
                        <input type="text" id="txtDDD" value="11" class="ddd" placeholder="DDD">
                        <input type="text" id="txtTel" value="96703-6123" class="numeroTel" placeholder="Seu número">
                    </div>
                </div>
                <div class="bloco-form">
                    <span>Sua Data de Nascimento</span><br>
                    <input type="date" id="txtDataNasc" value="2004-08-23">
                </div>
                <button class="btn" onclick="verificarEtapa1()">Prosseguir</button>
            </div>
        </div>
    </div>
    <div class="telaEtapa2 tela" id="telaPlaneta" style="display: none;">
        <h1 class="titulo">Qual o seu planeta favorito?</h1>
        <div class="container">
            <div class="bloco-imagem">
                <img src="assets/img/mercurio-removebg-preview.png" alt="Mercúrio" onclick="verificarPlaneta('Mercúrio')"
                style="margin-top: 5rem;" class="mercurio planeta">
                <br>
                <span>Mercúrio</span>
            </div>
            <div class="bloco-imagem">
                <img src="assets/img/imgVenus.png" alt="Vênus" onclick="verificarPlaneta('Vênus')" class="venus planeta">
                <br>
                <span>Vênus</span>
            </div>
            <div class="bloco-imagem">
                <img src="assets/img/terra.png" alt="Terra" onclick="verificarPlaneta('Terra')"
                style="margin-top: 5rem;" class="terra planeta">
                <br>
                <span>Terra</span>
            </div>
            <div class="bloco-imagem">
                <img src="assets/img/marte-removebg-preview.png" alt="Marte" onclick="verificarPlaneta('Marte')"
                style="margin-top: 10rem;" class="marte planeta">
                <br>
                <span>Marte</span>
            </div>
            <div class="bloco-imagem">
                <img src="assets/img/jupiter.png" alt="Júpiter" onclick="verificarPlaneta('Júpiter')"
                style="margin-top: 10rem;" class="jupiter planeta">
                <br>
                <span>Júpiter</span>
            </div>
            <div class="bloco-imagem">
                <img src="assets/img/saturno.png" alt="Saturno" onclick="verificarPlaneta('Saturno')"
                style="margin-top: 5rem;" class="saturno planeta">
                <br>
                <span>Saturno</span>
            </div>
            <div class="bloco-imagem">
                <img src="assets/img/urano-removebg-preview.png" alt="Urano" onclick="verificarPlaneta('Urano')" class="urano planeta">
                <br>
                <span>Urano</span>
            </div>
            <div class="bloco-imagem">
                <img src="assets/img/netuno-removebg-preview.png" alt="Netuno" onclick="verificarPlaneta('Netuno')"
                style="margin-top: 5rem;" class="netuno planeta">
                <br>
                <span>Netuno</span>
            </div>
        </div>
    </div>
    <div class="telaEtapa3 tela" id="telaDiaNoite" style="display: none;">
        <h1 class="titulo">Qual você prefere?</h1>
        <div class="containerDia colunaTela3">
            <div class="container">
                <div class="sol img-diaNoite"></div>
                <button class="btn btn-diaNoite" onclick="verificarDiaNoite('Dia')">Dia</button>
            </div>
        </div>
        <div class="containerNoite colunaTela3">
            <div class="container">
                <div class="lua img-diaNoite"></div>
                <button class="btn btn-diaNoite" onclick="verificarDiaNoite('Noite')">Noite</button>
            </div>
        </div>
    </div>
    <div class="telaEtapa4 tela" id="telaSenha" style="display: none;">
        <h1 class="titulo">Finalizando</h1>
        <div class="container">
            <div class="formulario-Etapa4 form">
                <div class="bloco-form">
                    <span>Seu Email</span><br>
                    <input type="email" id="txtEmail" value="davi.hilario@sptech.school">
                </div>
                <div class="bloco-form">
                    <span>Senha</span><br>
                    <input type="password" id="txtSenha" oninput="verificarNivel()">
                    <div class="linhaNivel" id="nivelDiv">
                        <div class="nivel" id="nivel1"></div>
                        <div class="nivel" id="nivel2"></div>
                        <div class="nivel" id="nivel3"></div>
                    </div>
                </div>
                <div class="bloco-form">
                    <span>Confirmar Senha</span><br>
                    <input type="password" id="txtConfirmarSenha">
                </div>
                <p>
                    Não iremos compartilhar
                    a sua senha com terceiros!
                </p>
                <button class="btn" onclick="verificarSenha()">Cadastrar</button>
            </div>
        </div>
    </div>
</body>

</html>
<script>

    let nome = ""
    let ddd = ""
    let telefone = ""
    let email = ""
    let dataNasc = ""
    let planetaFav = ""
    let diaNoite = ""
    let senha = ""

    let contador = 0;
    function prosseguir() {
        if (contador == 0) {
            telaInfo.style = 'display:none;'
            telaPlaneta.style = 'display:flex;'
        } if (contador == 1) {
            telaPlaneta.style = 'display:none;'
            telaDiaNoite.style = 'display:flex;'
        } if (contador == 2) {
            telaDiaNoite.style = 'display:none;'
            telaSenha.style = 'display:flex;'
        }
        contador++
    }

    function verificarEtapa1(){
        nome = txtNome.value
        ddd = txtDDD.value
        telefone = txtTel.value
        dataNasc = txtDataNasc.value
        // console.log((dataNasc.split('-'))[0])
        let erro = false

        // Verificações do Nome
        if(nome == ""){
            txtNome.placeholder = "Digite seu nome!"
            erro = true
        }else if(nome.length <= 2){
            txtNome.value = ''
            txtNome.placeholder = "O nome deve conter pelo menos 3 caracteres!"
            erro = true
        }

        // Verificando telefone e DDD
        if(ddd == ""){
            txtDDD.placeholder = 'Informe o DDD'
            erro = true
        }else if(ddd.length > 2){
            txtDDD.value = ''
            txtDDD.placeholder = 'DDD Inválido'
            erro = true
        }

        if(telefone == ""){
            txtTel.placeholder = 'Informe o telefone!'
            erro = true
        }else if(telefone.length > 10 || telefone.length < 8){
            txtTel.value = ''
            txtTel.placeholder = 'Telefone inválido!'
            erro = true
        }

        // Verificando data de nascimento
        if(dataNasc == ""){
            alert("Informe sua data de nascimento")
            erro = true
        }else if((dataNasc.split('-'))[0] > 2013){
            txtDataNasc.value = ""
            alert("Você deve ter pelo menos 10 anos para se cadastrar!")
            erro = true
        }

        // Verificando se há erros
        if(erro == false){
            prosseguir()
        }else{
            alert("Campos inválidos detectados! Verifique o conteúdo!")
        }
    }

    function verificarPlaneta(planeta) {
        planetaFav = planeta
        prosseguir()
    }

    function verificarDiaNoite(periodo) {
        diaNoite = periodo
        prosseguir()
    }

    function verificarSenha(){
        senha = txtSenha.value
        email = txtEmail.value
        let confirmarSenha = txtConfirmarSenha.value
        let erro = false

        // Campos inválidos?

        if(email == ""){
            txtEmail.placeholder = "Digite o Email!"
            erro = true
        }else if((email.indexOf('@') == -1) || (email.indexOf('.') == -1)){
            txtEmail.value = ''
            txtEmail.placeholder = "Email Inválido! Reveja o conteúdo!"
            erro = true
        }

        if(senha == ""){
            txtSenha.placeholder = 'Insira a senha!'
            erro = true
        }else if(senha.length < 8){
            alert("Erro! A senha deve conter pelo menos 8 caracteres!")
            erro = true
        }

        if(confirmarSenha == ""){
            txtConfirmarSenha.placeholder = 'Confirme sua senha!'
            erro = true
        }else if(confirmarSenha != senha){
            alert('Erro! Senhas diferentes!')
            erro = true
        }

        // Algum erro?

        if(erro == false){
            cadastrar()
        }else{
            alert("Campos Inválidos! Verifique o conteudo!")
        }
    }
    
    function verificarNivel(){
        nivelDiv.style = 'display:flex;'
        nivel1.style = 'background-color:white;'
        nivel2.style = 'background-color:white;'
        nivel3.style = 'background-color:white;'
        
        let simbolos = ['@',';','.','!','?','#','$','%']
        let numeros = [0,1,2,3,4,5,6,7,8,9]
        let maiusc = [
            'A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z'
        ]

        let countSimbolo = 0
        let countNumeros = 0
        let countMaiusc = 0
        let senhaNivel = txtSenha.value

        for(let i = 0; i <= simbolos.length - 1; i++){
            for(let j = 0; j <= senhaNivel.length - 1; j++){
                if(senhaNivel[j] == simbolos[i]){
                    countSimbolo++
                }
            }
        }
        for(let i = 0; i <= numeros.length - 1; i++){
            for(let j = 0; j <= senhaNivel.length - 1; j++){
                if(senhaNivel[j] == numeros[i]){
                    countNumeros++
                }
            }
        }
        for(let i = 0; i <= maiusc.length - 1; i++){
            for(let j = 0; j <= senhaNivel.length - 1; j++){
                if(senhaNivel[j] == maiusc[i]){
                    countMaiusc++
                }
            }
        }

        console.log('Quantidade de Símbolos encontrados: ' + countSimbolo)
        console.log('Quantidade de Números encontrados: ' + countNumeros)
        console.log('Quantidade de Maiúsculas encontradas: ' + countMaiusc)

        if(senhaNivel.length >= 0){
            nivel1.style = 'background-color:red;'
        }
        if((countMaiusc >= 1 && senhaNivel.length >= 4) || (countNumeros >= 2 && senhaNivel.length >= 4) || (countSimbolo >= 2 && senhaNivel.length >= 4)){
            nivel2.style = 'background-color:yellow;'

        }
        if(senhaNivel.length >= 8 && countMaiusc >= 1 && countNumeros >= 2 && countSimbolo >= 2){
            nivel3.style = 'background-color:green;'
        }
    }

    function cadastrar() {
        fetch('/usuarios/cadastrar', {
            method:'POST',
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                nomeServer: nome,
                dddServer: ddd,
                telServer: telefone,
                dataServer: dataNasc,
                emailServer: email,
                senhaServer: btoa(senha),
                planetaServer: planetaFav,
                diaNoiteServer: diaNoite
            })
        }).then((resposta) => {
            if(resposta.ok){
                alert('Cadastro Efetuado com Sucesso!')
                setTimeout(()=>{
                    window.location = "login.html";
                }, 2000)
            }else{
                alert('Erro ao realizar o cadastro!')
                // console.log(resposta)
                resposta.text().then(texto => {
                    console.error(texto)
                })
            }
        }).catch((erro) => {
            console.error(erro)
        })
    }
</script>